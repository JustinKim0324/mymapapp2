import streamlit as st
import yfinance as yf
import pandas as pd
import plotly.graph_objects as go
import plotly.express as px

st.set_page_config(page_title="ë‚˜ìŠ¤ë‹¥ 100 ì‹œì´ Top 10 ê¸°ì—… ì£¼ê°€ í˜„í™©", page_icon="ğŸ“ˆ", layout="wide")

NASDAQ_TOP_10 = {
    "Apple": ("AAPL", "ìŠ¤ë§ˆíŠ¸í°, PC ë° ë””ì§€í„¸ ì„œë¹„ìŠ¤ ë¶„ì•¼ë¥¼ ì„ ë„í•˜ëŠ” ê¸€ë¡œë²Œ IT ê¸°ì—…."),
    "Microsoft": ("MSFT", "ì†Œí”„íŠ¸ì›¨ì–´, í´ë¼ìš°ë“œ, ì¸ê³µì§€ëŠ¥ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê¸°ìˆ  ê¸°ì—…."),
    "Alphabet": ("GOOGL", "Googleì˜ ëª¨íšŒì‚¬ë¡œ ê²€ìƒ‰, ê´‘ê³ , í´ë¼ìš°ë“œ ì‚¬ì—…ì„ ìš´ì˜í•˜ëŠ” ê¸°ì—…."),
    "Amazon": ("AMZN", "ì„¸ê³„ ìµœëŒ€ì˜ ì˜¨ë¼ì¸ ë¦¬í…Œì¼ ë° í´ë¼ìš°ë“œ ì»´í“¨íŒ… ì„œë¹„ìŠ¤ ê¸°ì—…."),
    "NVIDIA": ("NVDA", "ê·¸ë˜í”½ ì¹´ë“œ ë° ì¸ê³µì§€ëŠ¥ ë°˜ë„ì²´ ë¶„ì•¼ ê¸€ë¡œë²Œ ë¦¬ë” ê¸°ì—…."),
    "Tesla": ("TSLA", "ì „ê¸°ìë™ì°¨ì™€ ì²­ì •ì—ë„ˆì§€ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” ê¸°ì—…."),
    "Meta": ("META", "ì†Œì…œë¯¸ë””ì–´ í”Œë«í¼ Facebookê³¼ Instagramì˜ ëª¨íšŒì‚¬."),
    "Broadcom": ("AVGO", "ë°˜ë„ì²´ ë° ì†Œí”„íŠ¸ì›¨ì–´ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” ê¸€ë¡œë²Œ ê¸°ìˆ ê¸°ì—…."),
    "PepsiCo": ("PEP", "ìŒë£Œì™€ ì‹í’ˆì„ ì œì¡°í•˜ê³  ìœ í†µí•˜ëŠ” ê¸€ë¡œë²Œ ê¸°ì—…."),
    "Costco": ("COST", "ëŒ€í˜• íšŒì›ì œ ì°½ê³ í˜• í• ì¸ë§¤ì¥ ìš´ì˜ ê¸°ì—….")
}

@st.cache_data
def get_stock_data(ticker, start_date="2024-01-01"):
    return yf.Ticker(ticker).history(start=start_date)

st.title("ğŸ“ˆ ë‚˜ìŠ¤ë‹¥ 100 ì‹œì´ Top 10 ê¸°ì—… ì£¼ê°€ ë¹„êµ (2024ë…„ 1ì›” ì´í›„)")
st.markdown("ë‚˜ìŠ¤ë‹¥ 100 ì‹œê°€ì´ì•¡ ìƒìœ„ 10ê°œ ê¸°ì—…ì˜ ì˜¬í•´ ì£¼ê°€ ìƒìŠ¹ë¥ ì„ ë¹„êµí•©ë‹ˆë‹¤.")

selected_companies = st.sidebar.multiselect(
    "ê¸°ì—… ì„ íƒ:",
    options=list(NASDAQ_TOP_10.keys()),
    default=list(NASDAQ_TOP_10.keys())[:3]
)

if not selected_companies:
    st.warning("ìµœì†Œ í•œ ê°œì˜ ê¸°ì—…ì„ ì„ íƒí•˜ì„¸ìš”.")
    st.stop()

with st.spinner("ë°ì´í„° ë¡œë”© ì¤‘..."):
    stock_data = {company: get_stock_data(NASDAQ_TOP_10[company][0]) for company in selected_companies}

st.header("ğŸ“Š ê¸°ì—… ê°œìš”")
cols = st.columns(len(selected_companies))

for idx, company in enumerate(selected_companies):
    ticker, summary = NASDAQ_TOP_10[company]
    current_price = stock_data[company]['Close'].iloc[-1]
    with cols[idx]:
        st.metric(label=f"{company}", value=f"${current_price:.2f}")
        st.caption(summary)

st.header("ğŸ“ˆ ë¹„êµ ìƒìŠ¹ë¥  ì°¨íŠ¸")

fig = go.Figure()
colors = px.colors.qualitative.Dark24

for idx, company in enumerate(selected_companies):
    data = stock_data[company]
    data["Return"] = (data["Close"] / data["Close"].iloc[0] - 1) * 100
    fig.add_trace(go.Scatter(
        x=data.index,
        y=data["Return"],
        mode="lines",
        name=company,
        line=dict(width=2, color=colors[idx % len(colors)]),
        hovertemplate=f"{company}<br>%{{x|%Y-%m-%d}}<br>ìƒìŠ¹ë¥ : %{{y:.2f}}%<extra></extra>"
    ))

fig.update_layout(
    title="2024ë…„ 1ì›” ì´í›„ ê¸°ì—…ë³„ ì£¼ê°€ ìƒìŠ¹ë¥  (%)",
    xaxis_title="ë‚ ì§œ",
    yaxis_title="ìƒìŠ¹ë¥  (%)",
    template="plotly_white",
    hovermode="x unified",
    height=600
)

st.plotly_chart(fig, use_container_width=True)

st.info("ë°ì´í„° ì†ŒìŠ¤: Yahoo Finance | ì°¸ê³ ìš©ì´ë©°, íˆ¬ì ê²°ì •ì€ ì‹ ì¤‘íˆ í•˜ì‹­ì‹œì˜¤.")
